<html>
<head>
<title>exceptions.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #7a7e85;}
.s5 { color: #6aab73;}
.s6 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
exceptions.py</font>
</center></td></tr></table>
<pre><span class="s0">&quot;&quot;&quot;Exceptions used throughout package. 
 
This module MUST NOT try to import from anything within `pip._internal` to 
operate. This is expected to be importable from any/all files within the 
subpackage and, thus, should not depend on them. 
&quot;&quot;&quot;</span>

<span class="s2">import </span><span class="s1">configparser</span>
<span class="s2">import </span><span class="s1">contextlib</span>
<span class="s2">import </span><span class="s1">locale</span>
<span class="s2">import </span><span class="s1">logging</span>
<span class="s2">import </span><span class="s1">pathlib</span>
<span class="s2">import </span><span class="s1">re</span>
<span class="s2">import </span><span class="s1">sys</span>
<span class="s2">from </span><span class="s1">itertools </span><span class="s2">import </span><span class="s1">chain</span><span class="s3">, </span><span class="s1">groupby</span><span class="s3">, </span><span class="s1">repeat</span>
<span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">TYPE_CHECKING</span><span class="s3">, </span><span class="s1">Dict</span><span class="s3">, </span><span class="s1">Iterator</span><span class="s3">, </span><span class="s1">List</span><span class="s3">, </span><span class="s1">Optional</span><span class="s3">, </span><span class="s1">Union</span>

<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_vendor</span><span class="s3">.</span><span class="s1">requests</span><span class="s3">.</span><span class="s1">models </span><span class="s2">import </span><span class="s1">Request</span><span class="s3">, </span><span class="s1">Response</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_vendor</span><span class="s3">.</span><span class="s1">rich</span><span class="s3">.</span><span class="s1">console </span><span class="s2">import </span><span class="s1">Console</span><span class="s3">, </span><span class="s1">ConsoleOptions</span><span class="s3">, </span><span class="s1">RenderResult</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_vendor</span><span class="s3">.</span><span class="s1">rich</span><span class="s3">.</span><span class="s1">markup </span><span class="s2">import </span><span class="s1">escape</span>
<span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_vendor</span><span class="s3">.</span><span class="s1">rich</span><span class="s3">.</span><span class="s1">text </span><span class="s2">import </span><span class="s1">Text</span>

<span class="s2">if </span><span class="s1">TYPE_CHECKING</span><span class="s3">:</span>
    <span class="s2">from </span><span class="s1">hashlib </span><span class="s2">import </span><span class="s1">_Hash</span>
    <span class="s2">from </span><span class="s1">typing </span><span class="s2">import </span><span class="s1">Literal</span>

    <span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">metadata </span><span class="s2">import </span><span class="s1">BaseDistribution</span>
    <span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">req</span><span class="s3">.</span><span class="s1">req_install </span><span class="s2">import </span><span class="s1">InstallRequirement</span>

<span class="s1">logger </span><span class="s3">= </span><span class="s1">logging</span><span class="s3">.</span><span class="s1">getLogger</span><span class="s3">(</span><span class="s1">__name__</span><span class="s3">)</span>


<span class="s4">#</span>
<span class="s4"># Scaffolding</span>
<span class="s4">#</span>
<span class="s2">def </span><span class="s1">_is_kebab_case</span><span class="s3">(</span><span class="s1">s</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
    <span class="s2">return </span><span class="s1">re</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s5">r&quot;^[a-z]+(-[a-z]+)*$&quot;</span><span class="s3">, </span><span class="s1">s</span><span class="s3">) </span><span class="s2">is not None</span>


<span class="s2">def </span><span class="s1">_prefix_with_indent</span><span class="s3">(</span>
    <span class="s1">s</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">Text</span><span class="s3">, </span><span class="s1">str</span><span class="s3">],</span>
    <span class="s1">console</span><span class="s3">: </span><span class="s1">Console</span><span class="s3">,</span>
    <span class="s3">*,</span>
    <span class="s1">prefix</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
    <span class="s1">indent</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
<span class="s3">) </span><span class="s1">-&gt; Text</span><span class="s3">:</span>
    <span class="s2">if </span><span class="s1">isinstance</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">Text</span><span class="s3">):</span>
        <span class="s1">text </span><span class="s3">= </span><span class="s1">s</span>
    <span class="s2">else</span><span class="s3">:</span>
        <span class="s1">text </span><span class="s3">= </span><span class="s1">console</span><span class="s3">.</span><span class="s1">render_str</span><span class="s3">(</span><span class="s1">s</span><span class="s3">)</span>

    <span class="s2">return </span><span class="s1">console</span><span class="s3">.</span><span class="s1">render_str</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">, </span><span class="s1">overflow</span><span class="s3">=</span><span class="s5">&quot;ignore&quot;</span><span class="s3">) + </span><span class="s1">console</span><span class="s3">.</span><span class="s1">render_str</span><span class="s3">(</span>
        <span class="s5">f&quot;</span><span class="s2">\n{</span><span class="s1">indent</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">, </span><span class="s1">overflow</span><span class="s3">=</span><span class="s5">&quot;ignore&quot;</span>
    <span class="s3">).</span><span class="s1">join</span><span class="s3">(</span><span class="s1">text</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s1">allow_blank</span><span class="s3">=</span><span class="s2">True</span><span class="s3">))</span>


<span class="s2">class </span><span class="s1">PipError</span><span class="s3">(</span><span class="s1">Exception</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;The base pip error.&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">DiagnosticPipError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;An error, that presents diagnostic information to the user. 
 
    This contains a bunch of logic, to enable pretty presentation of our error 
    messages. Each error gets a unique reference. Each error can also include 
    additional context, a hint and/or a note -- which are presented with the 
    main error message in a consistent style. 
 
    This is adapted from the error output styling in `sphinx-theme-builder`. 
    &quot;&quot;&quot;</span>

    <span class="s1">reference</span><span class="s3">: </span><span class="s1">str</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s3">*,</span>
        <span class="s1">kind</span><span class="s3">: </span><span class="s5">'Literal[&quot;error&quot;, &quot;warning&quot;]' </span><span class="s3">= </span><span class="s5">&quot;error&quot;</span><span class="s3">,</span>
        <span class="s1">reference</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">message</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Text</span><span class="s3">],</span>
        <span class="s1">context</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">Union</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Text</span><span class="s3">]],</span>
        <span class="s1">hint_stmt</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">Union</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Text</span><span class="s3">]],</span>
        <span class="s1">note_stmt</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">Union</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">Text</span><span class="s3">]] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">link</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s4"># Ensure a proper reference is provided.</span>
        <span class="s2">if </span><span class="s1">reference </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s2">assert </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s5">&quot;reference&quot;</span><span class="s3">), </span><span class="s5">&quot;error reference not provided!&quot;</span>
            <span class="s1">reference </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">reference</span>
        <span class="s2">assert </span><span class="s1">_is_kebab_case</span><span class="s3">(</span><span class="s1">reference</span><span class="s3">), </span><span class="s5">&quot;error reference must be kebab-case!&quot;</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">kind </span><span class="s3">= </span><span class="s1">kind</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">reference </span><span class="s3">= </span><span class="s1">reference</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">message </span><span class="s3">= </span><span class="s1">message</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">context </span><span class="s3">= </span><span class="s1">context</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">note_stmt </span><span class="s3">= </span><span class="s1">note_stmt</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">hint_stmt </span><span class="s3">= </span><span class="s1">hint_stmt</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">link </span><span class="s3">= </span><span class="s1">link</span>

        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s5">f&quot;&lt;</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">__class__</span><span class="s3">.</span><span class="s1">__name__</span><span class="s2">}</span><span class="s5">: </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">reference</span><span class="s2">}</span><span class="s5">&gt;&quot;</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__repr__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">(</span>
            <span class="s5">f&quot;&lt;</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">__class__</span><span class="s3">.</span><span class="s1">__name__</span><span class="s2">}</span><span class="s5">(&quot;</span>
            <span class="s5">f&quot;reference=</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">reference</span><span class="s2">!r}</span><span class="s5">, &quot;</span>
            <span class="s5">f&quot;message=</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">message</span><span class="s2">!r}</span><span class="s5">, &quot;</span>
            <span class="s5">f&quot;context=</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">context</span><span class="s2">!r}</span><span class="s5">, &quot;</span>
            <span class="s5">f&quot;note_stmt=</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">note_stmt</span><span class="s2">!r}</span><span class="s5">, &quot;</span>
            <span class="s5">f&quot;hint_stmt=</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">hint_stmt</span><span class="s2">!r}</span><span class="s5">&quot;</span>
            <span class="s5">&quot;)&gt;&quot;</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__rich_console__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">console</span><span class="s3">: </span><span class="s1">Console</span><span class="s3">,</span>
        <span class="s1">options</span><span class="s3">: </span><span class="s1">ConsoleOptions</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; RenderResult</span><span class="s3">:</span>
        <span class="s1">colour </span><span class="s3">= </span><span class="s5">&quot;red&quot; </span><span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">kind </span><span class="s3">== </span><span class="s5">&quot;error&quot; </span><span class="s2">else </span><span class="s5">&quot;yellow&quot;</span>

        <span class="s2">yield </span><span class="s5">f&quot;[</span><span class="s2">{</span><span class="s1">colour</span><span class="s2">} </span><span class="s5">bold]</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">kind</span><span class="s2">}</span><span class="s5">[/]: [bold]</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">reference</span><span class="s2">}</span><span class="s5">[/]&quot;</span>
        <span class="s2">yield </span><span class="s5">&quot;&quot;</span>

        <span class="s2">if not </span><span class="s1">options</span><span class="s3">.</span><span class="s1">ascii_only</span><span class="s3">:</span>
            <span class="s4"># Present the main message, with relevant context indented.</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">context </span><span class="s2">is not None</span><span class="s3">:</span>
                <span class="s2">yield </span><span class="s1">_prefix_with_indent</span><span class="s3">(</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">message</span><span class="s3">,</span>
                    <span class="s1">console</span><span class="s3">,</span>
                    <span class="s1">prefix</span><span class="s3">=</span><span class="s5">f&quot;[</span><span class="s2">{</span><span class="s1">colour</span><span class="s2">}</span><span class="s5">]×[/] &quot;</span><span class="s3">,</span>
                    <span class="s1">indent</span><span class="s3">=</span><span class="s5">f&quot;[</span><span class="s2">{</span><span class="s1">colour</span><span class="s2">}</span><span class="s5">]│[/] &quot;</span><span class="s3">,</span>
                <span class="s3">)</span>
                <span class="s2">yield </span><span class="s1">_prefix_with_indent</span><span class="s3">(</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">context</span><span class="s3">,</span>
                    <span class="s1">console</span><span class="s3">,</span>
                    <span class="s1">prefix</span><span class="s3">=</span><span class="s5">f&quot;[</span><span class="s2">{</span><span class="s1">colour</span><span class="s2">}</span><span class="s5">]╰─&gt;[/] &quot;</span><span class="s3">,</span>
                    <span class="s1">indent</span><span class="s3">=</span><span class="s5">f&quot;[</span><span class="s2">{</span><span class="s1">colour</span><span class="s2">}</span><span class="s5">]   [/] &quot;</span><span class="s3">,</span>
                <span class="s3">)</span>
            <span class="s2">else</span><span class="s3">:</span>
                <span class="s2">yield </span><span class="s1">_prefix_with_indent</span><span class="s3">(</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">message</span><span class="s3">,</span>
                    <span class="s1">console</span><span class="s3">,</span>
                    <span class="s1">prefix</span><span class="s3">=</span><span class="s5">&quot;[red]×[/] &quot;</span><span class="s3">,</span>
                    <span class="s1">indent</span><span class="s3">=</span><span class="s5">&quot;  &quot;</span><span class="s3">,</span>
                <span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">yield </span><span class="s1">self</span><span class="s3">.</span><span class="s1">message</span>
            <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">context </span><span class="s2">is not None</span><span class="s3">:</span>
                <span class="s2">yield </span><span class="s5">&quot;&quot;</span>
                <span class="s2">yield </span><span class="s1">self</span><span class="s3">.</span><span class="s1">context</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">note_stmt </span><span class="s2">is not None or </span><span class="s1">self</span><span class="s3">.</span><span class="s1">hint_stmt </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">yield </span><span class="s5">&quot;&quot;</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">note_stmt </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">yield </span><span class="s1">_prefix_with_indent</span><span class="s3">(</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">note_stmt</span><span class="s3">,</span>
                <span class="s1">console</span><span class="s3">,</span>
                <span class="s1">prefix</span><span class="s3">=</span><span class="s5">&quot;[magenta bold]note[/]: &quot;</span><span class="s3">,</span>
                <span class="s1">indent</span><span class="s3">=</span><span class="s5">&quot;      &quot;</span><span class="s3">,</span>
            <span class="s3">)</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">hint_stmt </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">yield </span><span class="s1">_prefix_with_indent</span><span class="s3">(</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">hint_stmt</span><span class="s3">,</span>
                <span class="s1">console</span><span class="s3">,</span>
                <span class="s1">prefix</span><span class="s3">=</span><span class="s5">&quot;[cyan bold]hint[/]: &quot;</span><span class="s3">,</span>
                <span class="s1">indent</span><span class="s3">=</span><span class="s5">&quot;      &quot;</span><span class="s3">,</span>
            <span class="s3">)</span>

        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">link </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">yield </span><span class="s5">&quot;&quot;</span>
            <span class="s2">yield </span><span class="s5">f&quot;Link: </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">link</span><span class="s2">}</span><span class="s5">&quot;</span>


<span class="s4">#</span>
<span class="s4"># Actual Errors</span>
<span class="s4">#</span>
<span class="s2">class </span><span class="s1">ConfigurationError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;General exception in configuration&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">InstallationError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;General exception during installation&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">UninstallationError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;General exception during uninstallation&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">MissingPyProjectBuildRequires</span><span class="s3">(</span><span class="s1">DiagnosticPipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when pyproject.toml has `build-system`, but no `build-system.requires`.&quot;&quot;&quot;</span>

    <span class="s1">reference </span><span class="s3">= </span><span class="s5">&quot;missing-pyproject-build-system-requires&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *, </span><span class="s1">package</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span>
            <span class="s1">message</span><span class="s3">=</span><span class="s5">f&quot;Can not process </span><span class="s2">{</span><span class="s1">escape</span><span class="s3">(</span><span class="s1">package</span><span class="s3">)</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">,</span>
            <span class="s1">context</span><span class="s3">=</span><span class="s1">Text</span><span class="s3">(</span>
                <span class="s5">&quot;This package has an invalid pyproject.toml file.</span><span class="s2">\n</span><span class="s5">&quot;</span>
                <span class="s5">&quot;The [build-system] table is missing the mandatory `requires` key.&quot;</span>
            <span class="s3">),</span>
            <span class="s1">note_stmt</span><span class="s3">=</span><span class="s5">&quot;This is an issue with the package mentioned above, not pip.&quot;</span><span class="s3">,</span>
            <span class="s1">hint_stmt</span><span class="s3">=</span><span class="s1">Text</span><span class="s3">(</span><span class="s5">&quot;See PEP 518 for the detailed specification.&quot;</span><span class="s3">),</span>
        <span class="s3">)</span>


<span class="s2">class </span><span class="s1">InvalidPyProjectBuildRequires</span><span class="s3">(</span><span class="s1">DiagnosticPipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when pyproject.toml an invalid `build-system.requires`.&quot;&quot;&quot;</span>

    <span class="s1">reference </span><span class="s3">= </span><span class="s5">&quot;invalid-pyproject-build-system-requires&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, *, </span><span class="s1">package</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">reason</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span>
            <span class="s1">message</span><span class="s3">=</span><span class="s5">f&quot;Can not process </span><span class="s2">{</span><span class="s1">escape</span><span class="s3">(</span><span class="s1">package</span><span class="s3">)</span><span class="s2">}</span><span class="s5">&quot;</span><span class="s3">,</span>
            <span class="s1">context</span><span class="s3">=</span><span class="s1">Text</span><span class="s3">(</span>
                <span class="s5">&quot;This package has an invalid `build-system.requires` key in &quot;</span>
                <span class="s5">f&quot;pyproject.toml.</span><span class="s2">\n{</span><span class="s1">reason</span><span class="s2">}</span><span class="s5">&quot;</span>
            <span class="s3">),</span>
            <span class="s1">note_stmt</span><span class="s3">=</span><span class="s5">&quot;This is an issue with the package mentioned above, not pip.&quot;</span><span class="s3">,</span>
            <span class="s1">hint_stmt</span><span class="s3">=</span><span class="s1">Text</span><span class="s3">(</span><span class="s5">&quot;See PEP 518 for the detailed specification.&quot;</span><span class="s3">),</span>
        <span class="s3">)</span>


<span class="s2">class </span><span class="s1">NoneMetadataError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when accessing a Distribution's &quot;METADATA&quot; or &quot;PKG-INFO&quot;. 
 
    This signifies an inconsistency, when the Distribution claims to have 
    the metadata file (if not, raise ``FileNotFoundError`` instead), but is 
    not actually able to produce its content. This may be due to permission 
    errors. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">dist</span><span class="s3">: </span><span class="s5">&quot;BaseDistribution&quot;</span><span class="s3">,</span>
        <span class="s1">metadata_name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        :param dist: A Distribution object. 
        :param metadata_name: The name of the metadata being accessed 
            (can be &quot;METADATA&quot; or &quot;PKG-INFO&quot;). 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">dist </span><span class="s3">= </span><span class="s1">dist</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">metadata_name </span><span class="s3">= </span><span class="s1">metadata_name</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4"># Use `dist` in the error message because its stringification</span>
        <span class="s4"># includes more information, like the version and location.</span>
        <span class="s2">return </span><span class="s5">&quot;None {} metadata found for distribution: {}&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">metadata_name</span><span class="s3">,</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">dist</span><span class="s3">,</span>
        <span class="s3">)</span>


<span class="s2">class </span><span class="s1">UserInstallationInvalid</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;A --user install is requested on an environment without user site.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">&quot;User base directory is not specified&quot;</span>


<span class="s2">class </span><span class="s1">InvalidSchemeCombination</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s1">before </span><span class="s3">= </span><span class="s5">&quot;, &quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">str</span><span class="s3">(</span><span class="s1">a</span><span class="s3">) </span><span class="s2">for </span><span class="s1">a </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">args</span><span class="s3">[:-</span><span class="s6">1</span><span class="s3">])</span>
        <span class="s2">return </span><span class="s5">f&quot;Cannot set </span><span class="s2">{</span><span class="s1">before</span><span class="s2">} </span><span class="s5">and </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">args</span><span class="s3">[-</span><span class="s6">1</span><span class="s3">]</span><span class="s2">} </span><span class="s5">together&quot;</span>


<span class="s2">class </span><span class="s1">DistributionNotFound</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when a distribution cannot be found to satisfy a requirement&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">RequirementsFileParseError</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when a general error occurs parsing a requirements file line.&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">BestVersionAlreadyInstalled</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when the most up-to-date version of a package is already 
    installed.&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">BadCommand</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when virtualenv or a command is not found&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">CommandError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when there is an error in command-line arguments&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">PreviousBuildDirError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Raised when there's a previous conflicting build directory&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">NetworkConnectionError</span><span class="s3">(</span><span class="s1">PipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;HTTP connection error&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">error_msg</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
        <span class="s1">response</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">Response</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">request</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">Request</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Initialize NetworkConnectionError with  `request` and `response` 
        objects. 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">response </span><span class="s3">= </span><span class="s1">response</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">request </span><span class="s3">= </span><span class="s1">request</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">error_msg </span><span class="s3">= </span><span class="s1">error_msg</span>
        <span class="s2">if </span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">response </span><span class="s2">is not None</span>
            <span class="s2">and not </span><span class="s1">self</span><span class="s3">.</span><span class="s1">request</span>
            <span class="s2">and </span><span class="s1">hasattr</span><span class="s3">(</span><span class="s1">response</span><span class="s3">, </span><span class="s5">&quot;request&quot;</span><span class="s3">)</span>
        <span class="s3">):</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">request </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">response</span><span class="s3">.</span><span class="s1">request</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">error_msg</span><span class="s3">, </span><span class="s1">response</span><span class="s3">, </span><span class="s1">request</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">error_msg</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">InvalidWheelFilename</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Invalid wheel filename.&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">UnsupportedWheel</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Unsupported wheel.&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">InvalidWheel</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Invalid (e.g. corrupt) wheel.&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">location</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">):</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">location </span><span class="s3">= </span><span class="s1">location</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s3">= </span><span class="s1">name</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">f&quot;Wheel '</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s2">}</span><span class="s5">' located at </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">location</span><span class="s2">} </span><span class="s5">is invalid.&quot;</span>


<span class="s2">class </span><span class="s1">MetadataInconsistent</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Built metadata contains inconsistent information. 
 
    This is raised when the metadata contains values (e.g. name and version) 
    that do not match the information previously obtained from sdist filename, 
    user-supplied ``#egg=`` value, or an install requirement name. 
    &quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">ireq</span><span class="s3">: </span><span class="s5">&quot;InstallRequirement&quot;</span><span class="s3">, </span><span class="s1">field</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">f_val</span><span class="s3">: </span><span class="s1">str</span><span class="s3">, </span><span class="s1">m_val</span><span class="s3">: </span><span class="s1">str</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">ireq </span><span class="s3">= </span><span class="s1">ireq</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">field </span><span class="s3">= </span><span class="s1">field</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">f_val </span><span class="s3">= </span><span class="s1">f_val</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">m_val </span><span class="s3">= </span><span class="s1">m_val</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s3">(</span>
            <span class="s5">f&quot;Requested </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">ireq</span><span class="s2">} </span><span class="s5">has inconsistent </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">field</span><span class="s2">}</span><span class="s5">: &quot;</span>
            <span class="s5">f&quot;expected </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">f_val</span><span class="s2">!r}</span><span class="s5">, but metadata has </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">m_val</span><span class="s2">!r}</span><span class="s5">&quot;</span>
        <span class="s3">)</span>


<span class="s2">class </span><span class="s1">InstallationSubprocessError</span><span class="s3">(</span><span class="s1">DiagnosticPipError</span><span class="s3">, </span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;A subprocess call failed.&quot;&quot;&quot;</span>

    <span class="s1">reference </span><span class="s3">= </span><span class="s5">&quot;subprocess-exited-with-error&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s3">*,</span>
        <span class="s1">command_description</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
        <span class="s1">exit_code</span><span class="s3">: </span><span class="s1">int</span><span class="s3">,</span>
        <span class="s1">output_lines</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">List</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]],</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">output_lines </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">output_prompt </span><span class="s3">= </span><span class="s1">Text</span><span class="s3">(</span><span class="s5">&quot;See above for output.&quot;</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">output_prompt </span><span class="s3">= (</span>
                <span class="s1">Text</span><span class="s3">.</span><span class="s1">from_markup</span><span class="s3">(</span><span class="s5">f&quot;[red][</span><span class="s2">{</span><span class="s1">len</span><span class="s3">(</span><span class="s1">output_lines</span><span class="s3">)</span><span class="s2">} </span><span class="s5">lines of output][/]</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">)</span>
                <span class="s3">+ </span><span class="s1">Text</span><span class="s3">(</span><span class="s5">&quot;&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">output_lines</span><span class="s3">))</span>
                <span class="s3">+ </span><span class="s1">Text</span><span class="s3">.</span><span class="s1">from_markup</span><span class="s3">(</span><span class="s5">R&quot;[red]\[end of output][/]&quot;</span><span class="s3">)</span>
            <span class="s3">)</span>

        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span>
            <span class="s1">message</span><span class="s3">=(</span>
                <span class="s5">f&quot;[green]</span><span class="s2">{</span><span class="s1">escape</span><span class="s3">(</span><span class="s1">command_description</span><span class="s3">)</span><span class="s2">}</span><span class="s5">[/] did not run successfully.</span><span class="s2">\n</span><span class="s5">&quot;</span>
                <span class="s5">f&quot;exit code: </span><span class="s2">{</span><span class="s1">exit_code</span><span class="s2">}</span><span class="s5">&quot;</span>
            <span class="s3">),</span>
            <span class="s1">context</span><span class="s3">=</span><span class="s1">output_prompt</span><span class="s3">,</span>
            <span class="s1">hint_stmt</span><span class="s3">=</span><span class="s2">None</span><span class="s3">,</span>
            <span class="s1">note_stmt</span><span class="s3">=(</span>
                <span class="s5">&quot;This error originates from a subprocess, and is likely not a &quot;</span>
                <span class="s5">&quot;problem with pip.&quot;</span>
            <span class="s3">),</span>
        <span class="s3">)</span>

        <span class="s1">self</span><span class="s3">.</span><span class="s1">command_description </span><span class="s3">= </span><span class="s1">command_description</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">exit_code </span><span class="s3">= </span><span class="s1">exit_code</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">command_description</span><span class="s2">} </span><span class="s5">exited with </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exit_code</span><span class="s2">}</span><span class="s5">&quot;</span>


<span class="s2">class </span><span class="s1">MetadataGenerationFailed</span><span class="s3">(</span><span class="s1">InstallationSubprocessError</span><span class="s3">, </span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s1">reference </span><span class="s3">= </span><span class="s5">&quot;metadata-generation-failed&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s3">*,</span>
        <span class="s1">package_details</span><span class="s3">: </span><span class="s1">str</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">super</span><span class="s3">(</span><span class="s1">InstallationSubprocessError</span><span class="s3">, </span><span class="s1">self</span><span class="s3">).</span><span class="s1">__init__</span><span class="s3">(</span>
            <span class="s1">message</span><span class="s3">=</span><span class="s5">&quot;Encountered error while generating package metadata.&quot;</span><span class="s3">,</span>
            <span class="s1">context</span><span class="s3">=</span><span class="s1">escape</span><span class="s3">(</span><span class="s1">package_details</span><span class="s3">),</span>
            <span class="s1">hint_stmt</span><span class="s3">=</span><span class="s5">&quot;See above for details.&quot;</span><span class="s3">,</span>
            <span class="s1">note_stmt</span><span class="s3">=</span><span class="s5">&quot;This is an issue with the package mentioned above, not pip.&quot;</span><span class="s3">,</span>
        <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">&quot;metadata generation failed&quot;</span>


<span class="s2">class </span><span class="s1">HashErrors</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Multiple HashError instances rolled into one for reporting&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">: </span><span class="s1">List</span><span class="s3">[</span><span class="s5">&quot;HashError&quot;</span><span class="s3">] = []</span>

    <span class="s2">def </span><span class="s1">append</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">error</span><span class="s3">: </span><span class="s5">&quot;HashError&quot;</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s1">lines </span><span class="s3">= []</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">.</span><span class="s1">sort</span><span class="s3">(</span><span class="s1">key</span><span class="s3">=</span><span class="s2">lambda </span><span class="s1">e</span><span class="s3">: </span><span class="s1">e</span><span class="s3">.</span><span class="s1">order</span><span class="s3">)</span>
        <span class="s2">for </span><span class="s1">cls</span><span class="s3">, </span><span class="s1">errors_of_cls </span><span class="s2">in </span><span class="s1">groupby</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">, </span><span class="s2">lambda </span><span class="s1">e</span><span class="s3">: </span><span class="s1">e</span><span class="s3">.</span><span class="s1">__class__</span><span class="s3">):</span>
            <span class="s1">lines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">cls</span><span class="s3">.</span><span class="s1">head</span><span class="s3">)</span>
            <span class="s1">lines</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span><span class="s1">e</span><span class="s3">.</span><span class="s1">body</span><span class="s3">() </span><span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">errors_of_cls</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">lines</span><span class="s3">:</span>
            <span class="s2">return </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">lines</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s5">&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__bool__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; bool</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s1">bool</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">errors</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">HashError</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    A failure to verify a package against known-good hashes 
 
    :cvar order: An int sorting hash exception classes by difficulty of 
        recovery (lower being harder), so the user doesn't bother fretting 
        about unpinned packages when he has deeper issues, like VCS 
        dependencies, to deal with. Also keeps error reports in a 
        deterministic order. 
    :cvar head: A section heading for display above potentially many 
        exceptions of this kind 
    :ivar req: The InstallRequirement that triggered this error. This is 
        pasted on after the exception is instantiated, because it's not 
        typically available earlier. 
 
    &quot;&quot;&quot;</span>

    <span class="s1">req</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s5">&quot;InstallRequirement&quot;</span><span class="s3">] = </span><span class="s2">None</span>
    <span class="s1">head </span><span class="s3">= </span><span class="s5">&quot;&quot;</span>
    <span class="s1">order</span><span class="s3">: </span><span class="s1">int </span><span class="s3">= -</span><span class="s6">1</span>

    <span class="s2">def </span><span class="s1">body</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Return a summary of me for display under the heading. 
 
        This default implementation simply prints a description of the 
        triggering requirement. 
 
        :param req: The InstallRequirement that provoked this error, with 
            its link already populated by the resolver's _populate_link(). 
 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s5">f&quot;    </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_requirement_name</span><span class="s3">()</span><span class="s2">}</span><span class="s5">&quot;</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">f&quot;</span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">head</span><span class="s2">}\n{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">()</span><span class="s2">}</span><span class="s5">&quot;</span>

    <span class="s2">def </span><span class="s1">_requirement_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot;Return a description of the requirement that triggered me. 
 
        This default implementation returns long description of the req, with 
        line numbers 
 
        &quot;&quot;&quot;</span>
        <span class="s2">return </span><span class="s1">str</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">req</span><span class="s3">) </span><span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">req </span><span class="s2">else </span><span class="s5">&quot;unknown package&quot;</span>


<span class="s2">class </span><span class="s1">VcsHashUnsupported</span><span class="s3">(</span><span class="s1">HashError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;A hash was provided for a version-control-system-based requirement, but 
    we don't have a method for hashing those.&quot;&quot;&quot;</span>

    <span class="s1">order </span><span class="s3">= </span><span class="s6">0</span>
    <span class="s1">head </span><span class="s3">= (</span>
        <span class="s5">&quot;Can't verify hashes for these requirements because we don't &quot;</span>
        <span class="s5">&quot;have a way to hash version control repositories:&quot;</span>
    <span class="s3">)</span>


<span class="s2">class </span><span class="s1">DirectoryUrlHashUnsupported</span><span class="s3">(</span><span class="s1">HashError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;A hash was provided for a version-control-system-based requirement, but 
    we don't have a method for hashing those.&quot;&quot;&quot;</span>

    <span class="s1">order </span><span class="s3">= </span><span class="s6">1</span>
    <span class="s1">head </span><span class="s3">= (</span>
        <span class="s5">&quot;Can't verify hashes for these file:// requirements because they &quot;</span>
        <span class="s5">&quot;point to directories:&quot;</span>
    <span class="s3">)</span>


<span class="s2">class </span><span class="s1">HashMissing</span><span class="s3">(</span><span class="s1">HashError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;A hash was needed for a requirement but is absent.&quot;&quot;&quot;</span>

    <span class="s1">order </span><span class="s3">= </span><span class="s6">2</span>
    <span class="s1">head </span><span class="s3">= (</span>
        <span class="s5">&quot;Hashes are required in --require-hashes mode, but they are &quot;</span>
        <span class="s5">&quot;missing from some requirements. Here is a list of those &quot;</span>
        <span class="s5">&quot;requirements along with the hashes their downloaded archives &quot;</span>
        <span class="s5">&quot;actually had. Add lines like these to your requirements files to &quot;</span>
        <span class="s5">&quot;prevent tampering. (If you did not enable --require-hashes &quot;</span>
        <span class="s5">&quot;manually, note that it turns on automatically when any package &quot;</span>
        <span class="s5">&quot;has a hash.)&quot;</span>
    <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">gotten_hash</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        :param gotten_hash: The hash of the (possibly malicious) archive we 
            just downloaded 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">gotten_hash </span><span class="s3">= </span><span class="s1">gotten_hash</span>

    <span class="s2">def </span><span class="s1">body</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s4"># Dodge circular import.</span>
        <span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">hashes </span><span class="s2">import </span><span class="s1">FAVORITE_HASH</span>

        <span class="s1">package </span><span class="s3">= </span><span class="s2">None</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">req</span><span class="s3">:</span>
            <span class="s4"># In the case of URL-based requirements, display the original URL</span>
            <span class="s4"># seen in the requirements file rather than the package name,</span>
            <span class="s4"># so the output can be directly copied into the requirements file.</span>
            <span class="s1">package </span><span class="s3">= (</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">req</span><span class="s3">.</span><span class="s1">original_link</span>
                <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">req</span><span class="s3">.</span><span class="s1">is_direct</span>
                <span class="s4"># In case someone feeds something downright stupid</span>
                <span class="s4"># to InstallRequirement's constructor.</span>
                <span class="s2">else </span><span class="s1">getattr</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">req</span><span class="s3">, </span><span class="s5">&quot;req&quot;</span><span class="s3">, </span><span class="s2">None</span><span class="s3">)</span>
            <span class="s3">)</span>
        <span class="s2">return </span><span class="s5">&quot;    {} --hash={}:{}&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span>
            <span class="s1">package </span><span class="s2">or </span><span class="s5">&quot;unknown package&quot;</span><span class="s3">, </span><span class="s1">FAVORITE_HASH</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">gotten_hash</span>
        <span class="s3">)</span>


<span class="s2">class </span><span class="s1">HashUnpinned</span><span class="s3">(</span><span class="s1">HashError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;A requirement had a hash specified but was not pinned to a specific 
    version.&quot;&quot;&quot;</span>

    <span class="s1">order </span><span class="s3">= </span><span class="s6">3</span>
    <span class="s1">head </span><span class="s3">= (</span>
        <span class="s5">&quot;In --require-hashes mode, all requirements must have their &quot;</span>
        <span class="s5">&quot;versions pinned with ==. These do not:&quot;</span>
    <span class="s3">)</span>


<span class="s2">class </span><span class="s1">HashMismatch</span><span class="s3">(</span><span class="s1">HashError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot; 
    Distribution file hash values don't match. 
 
    :ivar package_name: The name of the package that triggered the hash 
        mismatch. Feel free to write to this after the exception is raise to 
        improve its error message. 
 
    &quot;&quot;&quot;</span>

    <span class="s1">order </span><span class="s3">= </span><span class="s6">4</span>
    <span class="s1">head </span><span class="s3">= (</span>
        <span class="s5">&quot;THESE PACKAGES DO NOT MATCH THE HASHES FROM THE REQUIREMENTS &quot;</span>
        <span class="s5">&quot;FILE. If you have updated the package versions, please update &quot;</span>
        <span class="s5">&quot;the hashes. Otherwise, examine the package contents carefully; &quot;</span>
        <span class="s5">&quot;someone may have tampered with them.&quot;</span>
    <span class="s3">)</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">allowed</span><span class="s3">: </span><span class="s1">Dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s1">List</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]], </span><span class="s1">gots</span><span class="s3">: </span><span class="s1">Dict</span><span class="s3">[</span><span class="s1">str</span><span class="s3">, </span><span class="s5">&quot;_Hash&quot;</span><span class="s3">]) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        :param allowed: A dict of algorithm names pointing to lists of allowed 
            hex digests 
        :param gots: A dict of algorithm names pointing to hashes we 
            actually got from the files under suspicion 
        &quot;&quot;&quot;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">allowed </span><span class="s3">= </span><span class="s1">allowed</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">gots </span><span class="s3">= </span><span class="s1">gots</span>

    <span class="s2">def </span><span class="s1">body</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">return </span><span class="s5">&quot;    {}:</span><span class="s2">\n</span><span class="s5">{}&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">_requirement_name</span><span class="s3">(), </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_hash_comparison</span><span class="s3">())</span>

    <span class="s2">def </span><span class="s1">_hash_comparison</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s0">&quot;&quot;&quot; 
        Return a comparison of actual and expected hash values. 
 
        Example:: 
 
               Expected sha256 abcdeabcdeabcdeabcdeabcdeabcdeabcdeabcdeabcde 
                            or 123451234512345123451234512345123451234512345 
                    Got        bcdefbcdefbcdefbcdefbcdefbcdefbcdefbcdefbcdef 
 
        &quot;&quot;&quot;</span>

        <span class="s2">def </span><span class="s1">hash_then_or</span><span class="s3">(</span><span class="s1">hash_name</span><span class="s3">: </span><span class="s1">str</span><span class="s3">) </span><span class="s1">-&gt; </span><span class="s5">&quot;chain[str]&quot;</span><span class="s3">:</span>
            <span class="s4"># For now, all the decent hashes have 6-char names, so we can get</span>
            <span class="s4"># away with hard-coding space literals.</span>
            <span class="s2">return </span><span class="s1">chain</span><span class="s3">([</span><span class="s1">hash_name</span><span class="s3">], </span><span class="s1">repeat</span><span class="s3">(</span><span class="s5">&quot;    or&quot;</span><span class="s3">))</span>

        <span class="s1">lines</span><span class="s3">: </span><span class="s1">List</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = []</span>
        <span class="s2">for </span><span class="s1">hash_name</span><span class="s3">, </span><span class="s1">expecteds </span><span class="s2">in </span><span class="s1">self</span><span class="s3">.</span><span class="s1">allowed</span><span class="s3">.</span><span class="s1">items</span><span class="s3">():</span>
            <span class="s1">prefix </span><span class="s3">= </span><span class="s1">hash_then_or</span><span class="s3">(</span><span class="s1">hash_name</span><span class="s3">)</span>
            <span class="s1">lines</span><span class="s3">.</span><span class="s1">extend</span><span class="s3">(</span>
                <span class="s3">(</span><span class="s5">&quot;        Expected {} {}&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">next</span><span class="s3">(</span><span class="s1">prefix</span><span class="s3">), </span><span class="s1">e</span><span class="s3">)) </span><span class="s2">for </span><span class="s1">e </span><span class="s2">in </span><span class="s1">expecteds</span>
            <span class="s3">)</span>
            <span class="s1">lines</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span>
                <span class="s5">&quot;             Got        {}</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">format</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">gots</span><span class="s3">[</span><span class="s1">hash_name</span><span class="s3">].</span><span class="s1">hexdigest</span><span class="s3">())</span>
            <span class="s3">)</span>
        <span class="s2">return </span><span class="s5">&quot;</span><span class="s2">\n</span><span class="s5">&quot;</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">lines</span><span class="s3">)</span>


<span class="s2">class </span><span class="s1">UnsupportedPythonVersion</span><span class="s3">(</span><span class="s1">InstallationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;Unsupported python version according to Requires-Python package 
    metadata.&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">ConfigurationFileCouldNotBeLoaded</span><span class="s3">(</span><span class="s1">ConfigurationError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;When there are errors while loading a configuration file&quot;&quot;&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span>
        <span class="s1">self</span><span class="s3">,</span>
        <span class="s1">reason</span><span class="s3">: </span><span class="s1">str </span><span class="s3">= </span><span class="s5">&quot;could not be loaded&quot;</span><span class="s3">,</span>
        <span class="s1">fname</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
        <span class="s1">error</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">configparser</span><span class="s3">.</span><span class="s1">Error</span><span class="s3">] = </span><span class="s2">None</span><span class="s3">,</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">reason </span><span class="s3">= </span><span class="s1">reason</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">fname </span><span class="s3">= </span><span class="s1">fname</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">error </span><span class="s3">= </span><span class="s1">error</span>

    <span class="s2">def </span><span class="s1">__str__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) </span><span class="s1">-&gt; str</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">self</span><span class="s3">.</span><span class="s1">fname </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s1">message_part </span><span class="s3">= </span><span class="s5">f&quot; in </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">fname</span><span class="s2">}</span><span class="s5">.&quot;</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s2">assert </span><span class="s1">self</span><span class="s3">.</span><span class="s1">error </span><span class="s2">is not None</span>
            <span class="s1">message_part </span><span class="s3">= </span><span class="s5">f&quot;.</span><span class="s2">\n{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">error</span><span class="s2">}\n</span><span class="s5">&quot;</span>
        <span class="s2">return </span><span class="s5">f&quot;Configuration file </span><span class="s2">{</span><span class="s1">self</span><span class="s3">.</span><span class="s1">reason</span><span class="s2">}{</span><span class="s1">message_part</span><span class="s2">}</span><span class="s5">&quot;</span>


<span class="s1">_DEFAULT_EXTERNALLY_MANAGED_ERROR </span><span class="s3">= </span><span class="s5">f&quot;&quot;&quot;</span><span class="s2">\ 
</span><span class="s5">The Python environment under </span><span class="s2">{</span><span class="s1">sys</span><span class="s3">.</span><span class="s1">prefix</span><span class="s2">} </span><span class="s5">is managed externally, and may not be</span>
<span class="s5">manipulated by the user. Please use specific tooling from the distributor of</span>
<span class="s5">the Python installation to interact with this environment instead.</span>
<span class="s5">&quot;&quot;&quot;</span>


<span class="s2">class </span><span class="s1">ExternallyManagedEnvironment</span><span class="s3">(</span><span class="s1">DiagnosticPipError</span><span class="s3">):</span>
    <span class="s0">&quot;&quot;&quot;The current environment is externally managed. 
 
    This is raised when the current environment is externally managed, as 
    defined by `PEP 668`_. The ``EXTERNALLY-MANAGED`` configuration is checked 
    and displayed when the error is bubbled up to the user. 
 
    :param error: The error message read from ``EXTERNALLY-MANAGED``. 
    &quot;&quot;&quot;</span>

    <span class="s1">reference </span><span class="s3">= </span><span class="s5">&quot;externally-managed-environment&quot;</span>

    <span class="s2">def </span><span class="s1">__init__</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">error</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]) </span><span class="s1">-&gt; </span><span class="s2">None</span><span class="s3">:</span>
        <span class="s2">if </span><span class="s1">error </span><span class="s2">is None</span><span class="s3">:</span>
            <span class="s1">context </span><span class="s3">= </span><span class="s1">Text</span><span class="s3">(</span><span class="s1">_DEFAULT_EXTERNALLY_MANAGED_ERROR</span><span class="s3">)</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">context </span><span class="s3">= </span><span class="s1">Text</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)</span>
        <span class="s1">super</span><span class="s3">().</span><span class="s1">__init__</span><span class="s3">(</span>
            <span class="s1">message</span><span class="s3">=</span><span class="s5">&quot;This environment is externally managed&quot;</span><span class="s3">,</span>
            <span class="s1">context</span><span class="s3">=</span><span class="s1">context</span><span class="s3">,</span>
            <span class="s1">note_stmt</span><span class="s3">=(</span>
                <span class="s5">&quot;If you believe this is a mistake, please contact your &quot;</span>
                <span class="s5">&quot;Python installation or OS distribution provider. &quot;</span>
                <span class="s5">&quot;You can override this, at the risk of breaking your Python &quot;</span>
                <span class="s5">&quot;installation or OS, by passing --break-system-packages.&quot;</span>
            <span class="s3">),</span>
            <span class="s1">hint_stmt</span><span class="s3">=</span><span class="s1">Text</span><span class="s3">(</span><span class="s5">&quot;See PEP 668 for the detailed specification.&quot;</span><span class="s3">),</span>
        <span class="s3">)</span>

    <span class="s3">@</span><span class="s1">staticmethod</span>
    <span class="s2">def </span><span class="s1">_iter_externally_managed_error_keys</span><span class="s3">() </span><span class="s1">-&gt; Iterator</span><span class="s3">[</span><span class="s1">str</span><span class="s3">]:</span>
        <span class="s4"># LC_MESSAGES is in POSIX, but not the C standard. The most common</span>
        <span class="s4"># platform that does not implement this category is Windows, where</span>
        <span class="s4"># using other categories for console message localization is equally</span>
        <span class="s4"># unreliable, so we fall back to the locale-less vendor message. This</span>
        <span class="s4"># can always be re-evaluated when a vendor proposes a new alternative.</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">category </span><span class="s3">= </span><span class="s1">locale</span><span class="s3">.</span><span class="s1">LC_MESSAGES</span>
        <span class="s2">except </span><span class="s1">AttributeError</span><span class="s3">:</span>
            <span class="s1">lang</span><span class="s3">: </span><span class="s1">Optional</span><span class="s3">[</span><span class="s1">str</span><span class="s3">] = </span><span class="s2">None</span>
        <span class="s2">else</span><span class="s3">:</span>
            <span class="s1">lang</span><span class="s3">, </span><span class="s1">_ </span><span class="s3">= </span><span class="s1">locale</span><span class="s3">.</span><span class="s1">getlocale</span><span class="s3">(</span><span class="s1">category</span><span class="s3">)</span>
        <span class="s2">if </span><span class="s1">lang </span><span class="s2">is not None</span><span class="s3">:</span>
            <span class="s2">yield </span><span class="s5">f&quot;Error-</span><span class="s2">{</span><span class="s1">lang</span><span class="s2">}</span><span class="s5">&quot;</span>
            <span class="s2">for </span><span class="s1">sep </span><span class="s2">in </span><span class="s3">(</span><span class="s5">&quot;-&quot;</span><span class="s3">, </span><span class="s5">&quot;_&quot;</span><span class="s3">):</span>
                <span class="s1">before</span><span class="s3">, </span><span class="s1">found</span><span class="s3">, </span><span class="s1">_ </span><span class="s3">= </span><span class="s1">lang</span><span class="s3">.</span><span class="s1">partition</span><span class="s3">(</span><span class="s1">sep</span><span class="s3">)</span>
                <span class="s2">if not </span><span class="s1">found</span><span class="s3">:</span>
                    <span class="s2">continue</span>
                <span class="s2">yield </span><span class="s5">f&quot;Error-</span><span class="s2">{</span><span class="s1">before</span><span class="s2">}</span><span class="s5">&quot;</span>
        <span class="s2">yield </span><span class="s5">&quot;Error&quot;</span>

    <span class="s3">@</span><span class="s1">classmethod</span>
    <span class="s2">def </span><span class="s1">from_config</span><span class="s3">(</span>
        <span class="s1">cls</span><span class="s3">,</span>
        <span class="s1">config</span><span class="s3">: </span><span class="s1">Union</span><span class="s3">[</span><span class="s1">pathlib</span><span class="s3">.</span><span class="s1">Path</span><span class="s3">, </span><span class="s1">str</span><span class="s3">],</span>
    <span class="s3">) </span><span class="s1">-&gt; </span><span class="s5">&quot;ExternallyManagedEnvironment&quot;</span><span class="s3">:</span>
        <span class="s1">parser </span><span class="s3">= </span><span class="s1">configparser</span><span class="s3">.</span><span class="s1">ConfigParser</span><span class="s3">(</span><span class="s1">interpolation</span><span class="s3">=</span><span class="s2">None</span><span class="s3">)</span>
        <span class="s2">try</span><span class="s3">:</span>
            <span class="s1">parser</span><span class="s3">.</span><span class="s1">read</span><span class="s3">(</span><span class="s1">config</span><span class="s3">, </span><span class="s1">encoding</span><span class="s3">=</span><span class="s5">&quot;utf-8&quot;</span><span class="s3">)</span>
            <span class="s1">section </span><span class="s3">= </span><span class="s1">parser</span><span class="s3">[</span><span class="s5">&quot;externally-managed&quot;</span><span class="s3">]</span>
            <span class="s2">for </span><span class="s1">key </span><span class="s2">in </span><span class="s1">cls</span><span class="s3">.</span><span class="s1">_iter_externally_managed_error_keys</span><span class="s3">():</span>
                <span class="s2">with </span><span class="s1">contextlib</span><span class="s3">.</span><span class="s1">suppress</span><span class="s3">(</span><span class="s1">KeyError</span><span class="s3">):</span>
                    <span class="s2">return </span><span class="s1">cls</span><span class="s3">(</span><span class="s1">section</span><span class="s3">[</span><span class="s1">key</span><span class="s3">])</span>
        <span class="s2">except </span><span class="s1">KeyError</span><span class="s3">:</span>
            <span class="s2">pass</span>
        <span class="s2">except </span><span class="s3">(</span><span class="s1">OSError</span><span class="s3">, </span><span class="s1">UnicodeDecodeError</span><span class="s3">, </span><span class="s1">configparser</span><span class="s3">.</span><span class="s1">ParsingError</span><span class="s3">):</span>
            <span class="s2">from </span><span class="s1">pip</span><span class="s3">.</span><span class="s1">_internal</span><span class="s3">.</span><span class="s1">utils</span><span class="s3">.</span><span class="s1">_log </span><span class="s2">import </span><span class="s1">VERBOSE</span>

            <span class="s1">exc_info </span><span class="s3">= </span><span class="s1">logger</span><span class="s3">.</span><span class="s1">isEnabledFor</span><span class="s3">(</span><span class="s1">VERBOSE</span><span class="s3">)</span>
            <span class="s1">logger</span><span class="s3">.</span><span class="s1">warning</span><span class="s3">(</span><span class="s5">&quot;Failed to read %s&quot;</span><span class="s3">, </span><span class="s1">config</span><span class="s3">, </span><span class="s1">exc_info</span><span class="s3">=</span><span class="s1">exc_info</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">cls</span><span class="s3">(</span><span class="s2">None</span><span class="s3">)</span>
</pre>
</body>
</html>